import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from "react";

const I18nContext = createContext(null);
const LANGUAGE_KEY = "ewp_language";
const SUPPORTED_LANGUAGES = ["ru", "kz", "en"];

const DICTIONARY = {
  en: {
    "language.ru": "RU",
    "language.kz": "KZ",
    "language.en": "EN",
    "navbar.kicker": "Inequality and macroeconomic intelligence",
    "navbar.title": "Economic Signals Studio",
    "navbar.worldBank": "World Bank",
    "navbar.labNotes": "Lab Notes",
    "navbar.signIn": "Sign in",
    "navbar.account": "Account",
    "navbar.openSignIn": "Open sign in",
    "navbar.openAccount": "Open account",
    "navbar.themeLight": "Light",
    "navbar.themeDark": "Dark",
    "navbar.switchTo": "Switch to {{mode}} mode",
    "navbar.lightMode": "light",
    "navbar.darkMode": "dark",
    "layout.navigation": "Navigation",
    "layout.dashboard": "Dashboard",
    "layout.inequality": "Inequality",
    "layout.forecast": "Forecast",
    "layout.saved": "Saved",
    "common.na": "n/a",
    "common.close": "Close",
    "footer.referencesTitle": "References",
    "footer.referencesSubtitle": "Data sources and project links are placed in the footer.",
    "home.heroKicker": "Dashboard",
    "home.heroTitle": "Compare inequality with macroeconomic pressure points.",
    "home.heroSubtitle": "Normalize indicators across countries, align timelines, and explore correlations between inequality and growth, inflation, or unemployment.",
    "home.dataAssurance": "Data assurance",
    "home.dataSourceItem": "Source: World Bank catalog + planned IMF/OECD ingestion.",
    "home.dataHistoryItem": "Historical vs derived vs forecast values are separated.",
    "home.dataMissingItem": "Missing data is preserved and surfaced for transparency.",
    "home.controlsTitle": "Comparison Controls",
    "home.chartType": "Chart Type",
    "home.chartLine": "Line",
    "home.chartBar": "Bar",
    "home.chartScatter": "Scatter",
    "home.startYear": "Start Year",
    "home.endYear": "End Year",
    "home.runComparison": "Run comparison",
    "home.loading": "Loading...",
    "home.countSummary": "{{countries}} countries · {{indicators}} indicators",
    "home.availableYearRange": "Available year range: {{min}}-{{max}}",
    "home.errorSelectMin": "Select at least one country and one indicator.",
    "home.errorTooManySelection": "Too many selections for one run. Use up to {{countries}} countries and {{indicators}} indicators.",
    "home.errorStartEnd": "Start year must be less than or equal to end year.",
    "home.errorYearRange": "Year range must be between {{min}} and {{max}}.",
    "home.errorLoad": "Failed to load analytics. Check that FastAPI service is running.",
    "selector.countries": "Countries",
    "selector.searchCountry": "Search country...",
    "selector.noCountries": "No countries found.",
    "selector.countriesSelected": "{{selected}}/{{max}} selected. Use checkboxes to compare countries side by side.",
    "selector.tooManyCountries": "Too many countries selected. Maximum is {{max}}.",
    "selector.indicators": "Indicators",
    "selector.searchIndicator": "Search indicator...",
    "selector.noIndicators": "No indicators found.",
    "selector.indicatorsSelected": "{{selected}}/{{max}} selected. Use checkboxes to compare multiple indicators.",
    "selector.tooManyIndicators": "Too many indicators selected. Maximum is {{max}}.",
    "comparison.empty": "Select countries and indicators, then run the comparison to populate charts.",
    "comparison.historicalByCountry": "Historical series by country. Missing values are left blank to preserve data integrity.",
    "comparison.exportCsv": "Export CSV",
    "comparison.correlationSnapshot": "Correlation Snapshot",
    "comparison.correlationSubtitle": "Pearson correlation between {{indicatorA}} and {{indicatorB}} on overlapping years.",
    "chart.selectFilters": "Select filters and fetch data.",
    "chart.lineOfEquality": "Line of equality",
    "chart.populationShare": "Cumulative population share",
    "chart.incomeShare": "Cumulative income share",
    "chart.tooltipLorenz": "{{label}}: {{population}} population, {{income}} income",
    "chart.year": "Year",
    "chart.value": "Value",
    "chart.downloadPng": "Download PNG",
    "ai.defaultPrompt": "Explain what this chart shows and which trends matter.",
    "ai.title": "AI Chart Agent",
    "ai.subtitle": "Ask a question about the current chart output and get a short analytical explanation.",
    "ai.questionLabel": "Your question",
    "ai.placeholder": "For example: Which country has the fastest growth and where are the risks?",
    "ai.analyzing": "Analyzing...",
    "ai.explain": "Explain chart",
    "ai.rangeIndicators": "Range: {{start}}-{{end}} · Indicators: {{count}}",
    "ai.errorNoData": "Run comparison first and enter a question for the AI agent.",
    "ai.errorFailed": "AI explanation failed. Check FastAPI provider configuration.",
    "ai.explanationTitle": "AI Explanation",
    "ai.provider": "Provider",
    "ai.model": "Model",
    "ai.providerNa": "n/a",
    "forecastPage.heroKicker": "Forecast",
    "forecastPage.heroTitle": "Generate transparent baseline forecasts.",
    "forecastPage.heroSubtitle": "Forecasts include confidence bands and backtesting metrics (MAE/RMSE) for defensible interpretation.",
    "forecastPage.accessTitle": "Access",
    "forecastPage.accessSubtitle": "Agreement acceptance is required to access forecasting endpoints.",
    "inequalityPage.heroKicker": "Inequality analytics",
    "inequalityPage.heroTitle": "Track inequality trends across time.",
    "inequalityPage.heroSubtitle": "Explore Gini trends, year-over-year shifts, and compare trajectories across selected countries.",
    "inequalityPage.notesTitle": "Notes",
    "inequalityPage.note1": "Server-side enforcement: agreement required.",
    "inequalityPage.note2": "Sources are surfaced for transparency.",
    "savedPage.title": "Saved analysis presets",
    "savedPage.subtitle": "Presets let you store multi-country selections, indicators, chart type and year range, then restore them later. Manage them in the Saved presets block at the bottom of the page.",
    "auth.session": "Session",
    "auth.signedInAs": "Signed in as {{username}}",
    "auth.signOut": "Sign out",
    "auth.access": "Access",
    "auth.login": "Login",
    "auth.register": "Register",
    "auth.username": "Username",
    "auth.email": "Email",
    "auth.password": "Password",
    "auth.agreeTo": "I agree to the {{title}}",
    "auth.processing": "Processing...",
    "auth.signIn": "Sign in",
    "auth.createAccount": "Create account",
    "auth.loginFailed": "Login failed. Check credentials.",
    "auth.registrationFailed": "Registration failed. Review the form and try again.",
    "auth.registrationSuccess": "Registration successful. You can log in now.",
    "auth.agreementUnavailable": "Agreement unavailable.",
    "auth.invalidCredentials": "Invalid credentials.",
    "auth.sessionExpired": "Session expired.",
    "agreement.title": "User Agreement",
    "agreement.loading": "Loading agreement...",
    "agreement.none": "No active agreement published.",
    "agreement.version": "Version {{version}}",
    "agreement.required": "Agreement required for forecasts and advanced analytics.",
    "agreement.accepted": "Accepted",
    "agreement.accept": "Accept",
    "preset.title": "Saved presets",
    "preset.signInHint": "Sign in to save and restore analysis setups.",
    "preset.name": "Preset name",
    "preset.placeholder": "e.g. KZ vs RU · Gini + inflation",
    "preset.overwrite": "Overwrite if name exists",
    "preset.saving": "Saving...",
    "preset.saveCurrent": "Save current selection",
    "preset.errorLoad": "Unable to load saved presets.",
    "preset.errorName": "Enter a preset name.",
    "preset.errorSignIn": "Sign in to save presets.",
    "preset.saved": "Preset saved.",
    "preset.errorExists": "Preset name already exists. Enable overwrite to replace it.",
    "preset.errorSave": "Failed to save preset.",
    "preset.loaded": "Loaded: {{name}}",
    "preset.deleted": "Preset deleted.",
    "preset.errorDelete": "Failed to delete preset.",
    "preset.none": "No presets saved yet.",
    "preset.updated": "Updated {{date}}",
    "preset.load": "Load",
    "preset.delete": "Delete",
    "gini.errorSelectCountry": "Select at least one country to load Gini trends.",
    "gini.errorNeedAgreement": "Accept the agreement to unlock inequality analytics.",
    "gini.errorFailed": "Failed to load Gini trend analytics. Ensure FastAPI is running and agreement is accepted.",
    "gini.title": "Inequality trend (Gini)",
    "gini.subtitle": "Trend line based on World Bank Gini indicator (SI.POV.GINI). Use it for cross-country trend context and YoY shifts.",
    "gini.loading": "Loading...",
    "gini.load": "Load Gini trends",
    "gini.lastYear": "Last year: {{year}}",
    "gini.noData": "No data",
    "gini.source": "Source {{source}}",
    "forecast.title": "Forecasting Studio",
    "forecast.subtitle": "Forecasts are probabilistic, not guaranteed. Use them for academic exploration and scenario comparison rather than direct policy decisions.",
    "forecast.predictionsOnly": "Predictions only",
    "forecast.country": "Country",
    "forecast.selectCountry": "Select country",
    "forecast.indicator": "Indicator",
    "forecast.selectIndicator": "Select indicator",
    "forecast.horizon": "Horizon (years)",
    "forecast.chartHistorical": "Historical",
    "forecast.chartForecast": "Forecast",
    "forecast.chartLower": "Lower bound",
    "forecast.chartUpper": "Upper bound",
    "forecast.running": "Running...",
    "forecast.generate": "Generate",
    "forecast.latestRun": "Latest run",
    "forecast.errorSelect": "Select a country and indicator.",
    "forecast.errorGenerate": "Unable to generate forecast. Ensure data is ingested and agreement accepted.",
    "forecast.errorLatest": "No saved forecast found for this selection.",
    "forecast.needAgreement": "Accept the active user agreement to unlock forecasting endpoints.",
    "forecast.dataQuality": "Data quality",
    "forecast.coverage": "Coverage {{percent}}% ({{actual}}/{{expected}})",
    "forecast.source": "Source {{source}}",
    "forecast.lowCoverage": "Low coverage",
    "forecast.disclaimerTitle": "Academic disclaimer",
    "forecast.disclaimerText": "Forecasts are generated from historical indicators (Gini, GDP, inflation, employment) and reflect model assumptions. The platform is not responsible for decisions based on predicted values.",
    "forecast.model": "Model: {{value}}",
    "forecast.assumptions": "Assumptions: {{value}}",
    "forecast.metrics": "Metrics: {{value}}",
    "forecast.baseline": "Baseline",
    "forecast.lastHistorical": "Last historical value",
    "forecast.change": "Change",
    "forecast.avgAnnual": "Avg annual: {{value}}",
    "forecast.percent": "Percent",
    "forecast.horizonShift": "Horizon total shift",
  },
  ru: {
    "language.ru": "RU",
    "language.kz": "KZ",
    "language.en": "EN",
    "navbar.kicker": "Аналитика неравенства и макроэкономики",
    "navbar.title": "Economic Signals Studio",
    "navbar.worldBank": "World Bank",
    "navbar.labNotes": "Lab Notes",
    "navbar.signIn": "Вход",
    "navbar.account": "Аккаунт",
    "navbar.openSignIn": "Открыть вход",
    "navbar.openAccount": "Открыть аккаунт",
    "navbar.themeLight": "Светлая",
    "navbar.themeDark": "Тёмная",
    "navbar.switchTo": "Переключить на {{mode}} тему",
    "navbar.lightMode": "светлую",
    "navbar.darkMode": "тёмную",
    "layout.navigation": "Навигация",
    "layout.dashboard": "Дашборд",
    "layout.inequality": "Неравенство",
    "layout.forecast": "Прогноз",
    "layout.saved": "Сохранённые",
    "common.na": "н/д",
    "common.close": "Закрыть",
    "footer.referencesTitle": "Референсы",
    "footer.referencesSubtitle": "Источники данных и проектные ссылки перенесены в футер.",
    "home.heroKicker": "Дашборд",
    "home.heroTitle": "Сравнение неравенства и макроэкономических факторов.",
    "home.heroSubtitle": "Нормализуйте индикаторы по странам, выравнивайте временные ряды и анализируйте корреляции между неравенством, ростом, инфляцией и безработицей.",
    "home.dataAssurance": "Надёжность данных",
    "home.dataSourceItem": "Источник: каталог World Bank + планируемый ingestion IMF/OECD.",
    "home.dataHistoryItem": "Исторические, вычисленные и прогнозные значения разделены.",
    "home.dataMissingItem": "Пропуски сохраняются и явно отображаются для прозрачности.",
    "home.controlsTitle": "Параметры сравнения",
    "home.chartType": "Тип графика",
    "home.chartLine": "Линия",
    "home.chartBar": "Столбцы",
    "home.chartScatter": "Точки",
    "home.startYear": "Начальный год",
    "home.endYear": "Конечный год",
    "home.runComparison": "Запустить сравнение",
    "home.loading": "Загрузка...",
    "home.countSummary": "{{countries}} стран · {{indicators}} индикаторов",
    "home.availableYearRange": "Доступный диапазон лет: {{min}}-{{max}}",
    "home.errorSelectMin": "Выберите минимум одну страну и один индикатор.",
    "home.errorTooManySelection": "Слишком много значений для одного запуска. Используйте до {{countries}} стран и {{indicators}} индикаторов.",
    "home.errorStartEnd": "Начальный год должен быть меньше или равен конечному.",
    "home.errorYearRange": "Диапазон лет должен быть между {{min}} и {{max}}.",
    "home.errorLoad": "Не удалось загрузить аналитику. Проверьте, что FastAPI запущен.",
    "selector.countries": "Страны",
    "selector.searchCountry": "Поиск страны...",
    "selector.noCountries": "Страны не найдены.",
    "selector.countriesSelected": "Выбрано {{selected}}/{{max}}. Используйте чекбоксы для сравнения стран.",
    "selector.tooManyCountries": "Слишком много стран. Максимум: {{max}}.",
    "selector.indicators": "Индикаторы",
    "selector.searchIndicator": "Поиск индикатора...",
    "selector.noIndicators": "Индикаторы не найдены.",
    "selector.indicatorsSelected": "Выбрано {{selected}}/{{max}}. Используйте чекбоксы для сравнения индикаторов.",
    "selector.tooManyIndicators": "Слишком много индикаторов. Максимум: {{max}}.",
    "comparison.empty": "Выберите страны и индикаторы, затем запустите сравнение для построения графиков.",
    "comparison.historicalByCountry": "Исторические ряды по странам. Пропущенные значения оставляются пустыми для сохранения целостности данных.",
    "comparison.exportCsv": "Экспорт CSV",
    "comparison.correlationSnapshot": "Снимок корреляции",
    "comparison.correlationSubtitle": "Корреляция Пирсона между {{indicatorA}} и {{indicatorB}} на пересекающихся годах.",
    "chart.selectFilters": "Выберите фильтры и загрузите данные.",
    "chart.lineOfEquality": "Линия равенства",
    "chart.populationShare": "Накопленная доля населения",
    "chart.incomeShare": "Накопленная доля дохода",
    "chart.tooltipLorenz": "{{label}}: {{population}} населения, {{income}} дохода",
    "chart.year": "Год",
    "chart.value": "Значение",
    "chart.downloadPng": "Скачать PNG",
    "ai.defaultPrompt": "Объясни, что показывает график и какие тренды важны.",
    "ai.title": "AI агент графика",
    "ai.subtitle": "Задайте вопрос по текущему графику и получите краткое аналитическое объяснение.",
    "ai.questionLabel": "Ваш вопрос",
    "ai.placeholder": "Например: какая страна растёт быстрее и где основные риски?",
    "ai.analyzing": "Анализ...",
    "ai.explain": "Объяснить график",
    "ai.rangeIndicators": "Диапазон: {{start}}-{{end}} · Индикаторы: {{count}}",
    "ai.errorNoData": "Сначала запустите сравнение и введите вопрос для AI-агента.",
    "ai.errorFailed": "Не удалось получить AI-объяснение. Проверьте конфигурацию провайдера FastAPI.",
    "ai.explanationTitle": "AI объяснение",
    "ai.provider": "Провайдер",
    "ai.model": "Модель",
    "ai.providerNa": "н/д",
    "forecastPage.heroKicker": "Прогноз",
    "forecastPage.heroTitle": "Формируйте прозрачные базовые прогнозы.",
    "forecastPage.heroSubtitle": "Прогнозы включают доверительные интервалы и метрики бэктестинга (MAE/RMSE) для обоснованной интерпретации.",
    "forecastPage.accessTitle": "Доступ",
    "forecastPage.accessSubtitle": "Для доступа к endpoint прогнозирования требуется принять соглашение.",
    "inequalityPage.heroKicker": "Аналитика неравенства",
    "inequalityPage.heroTitle": "Отслеживайте динамику неравенства во времени.",
    "inequalityPage.heroSubtitle": "Изучайте тренды Gini, изменения год-к-году и сравнивайте траектории между выбранными странами.",
    "inequalityPage.notesTitle": "Заметки",
    "inequalityPage.note1": "Серверное ограничение: требуется принятие соглашения.",
    "inequalityPage.note2": "Источники данных отображаются для прозрачности.",
    "savedPage.title": "Сохранённые пресеты анализа",
    "savedPage.subtitle": "Пресеты позволяют сохранять выбор стран, индикаторов, типа графика и диапазона лет, а затем восстанавливать его позже. Управление доступно в блоке Saved presets внизу страницы.",
    "auth.session": "Сессия",
    "auth.signedInAs": "Вход выполнен как {{username}}",
    "auth.signOut": "Выйти",
    "auth.access": "Доступ",
    "auth.login": "Вход",
    "auth.register": "Регистрация",
    "auth.username": "Имя пользователя",
    "auth.email": "Email",
    "auth.password": "Пароль",
    "auth.agreeTo": "Я принимаю {{title}}",
    "auth.processing": "Обработка...",
    "auth.signIn": "Войти",
    "auth.createAccount": "Создать аккаунт",
    "auth.loginFailed": "Ошибка входа. Проверьте учётные данные.",
    "auth.registrationFailed": "Ошибка регистрации. Проверьте форму и попробуйте снова.",
    "auth.registrationSuccess": "Регистрация успешна. Теперь можно войти.",
    "auth.agreementUnavailable": "Соглашение недоступно.",
    "auth.invalidCredentials": "Неверные учётные данные.",
    "auth.sessionExpired": "Сессия истекла.",
    "agreement.title": "Пользовательское соглашение",
    "agreement.loading": "Загрузка соглашения...",
    "agreement.none": "Активное соглашение не опубликовано.",
    "agreement.version": "Версия {{version}}",
    "agreement.required": "Соглашение обязательно для прогнозов и расширенной аналитики.",
    "agreement.accepted": "Принято",
    "agreement.accept": "Принять",
    "preset.title": "Сохранённые пресеты",
    "preset.signInHint": "Войдите в систему, чтобы сохранять и восстанавливать наборы анализа.",
    "preset.name": "Название пресета",
    "preset.placeholder": "например: KZ vs RU · Gini + inflation",
    "preset.overwrite": "Перезаписать, если имя уже существует",
    "preset.saving": "Сохранение...",
    "preset.saveCurrent": "Сохранить текущий выбор",
    "preset.errorLoad": "Не удалось загрузить сохранённые пресеты.",
    "preset.errorName": "Введите название пресета.",
    "preset.errorSignIn": "Войдите, чтобы сохранять пресеты.",
    "preset.saved": "Пресет сохранён.",
    "preset.errorExists": "Имя пресета уже существует. Включите перезапись, чтобы заменить.",
    "preset.errorSave": "Не удалось сохранить пресет.",
    "preset.loaded": "Загружено: {{name}}",
    "preset.deleted": "Пресет удалён.",
    "preset.errorDelete": "Не удалось удалить пресет.",
    "preset.none": "Пока нет сохранённых пресетов.",
    "preset.updated": "Обновлено {{date}}",
    "preset.load": "Загрузить",
    "preset.delete": "Удалить",
    "gini.errorSelectCountry": "Выберите хотя бы одну страну для загрузки трендов Gini.",
    "gini.errorNeedAgreement": "Примите соглашение для доступа к аналитике неравенства.",
    "gini.errorFailed": "Не удалось загрузить тренды Gini. Убедитесь, что FastAPI запущен и соглашение принято.",
    "gini.title": "Тренд неравенства (Gini)",
    "gini.subtitle": "Линия тренда на основе индикатора Gini World Bank (SI.POV.GINI). Используйте для межстранового сравнения и анализа год-к-году.",
    "gini.loading": "Загрузка...",
    "gini.load": "Загрузить тренды Gini",
    "gini.lastYear": "Последний год: {{year}}",
    "gini.noData": "Нет данных",
    "gini.source": "Источник {{source}}",
    "forecast.title": "Прогнозная студия",
    "forecast.subtitle": "Прогнозы вероятностные и не являются гарантией. Используйте их для академического анализа и сравнения сценариев, а не для прямых решений политики.",
    "forecast.predictionsOnly": "Только прогнозы",
    "forecast.country": "Страна",
    "forecast.selectCountry": "Выберите страну",
    "forecast.indicator": "Индикатор",
    "forecast.selectIndicator": "Выберите индикатор",
    "forecast.horizon": "Горизонт (лет)",
    "forecast.chartHistorical": "Исторические",
    "forecast.chartForecast": "Прогноз",
    "forecast.chartLower": "Нижняя граница",
    "forecast.chartUpper": "Верхняя граница",
    "forecast.running": "Запуск...",
    "forecast.generate": "Сгенерировать",
    "forecast.latestRun": "Последний запуск",
    "forecast.errorSelect": "Выберите страну и индикатор.",
    "forecast.errorGenerate": "Не удалось сгенерировать прогноз. Убедитесь, что данные загружены и соглашение принято.",
    "forecast.errorLatest": "Для этого выбора нет сохранённого прогноза.",
    "forecast.needAgreement": "Примите активное пользовательское соглашение, чтобы открыть endpoint прогнозирования.",
    "forecast.dataQuality": "Качество данных",
    "forecast.coverage": "Покрытие {{percent}}% ({{actual}}/{{expected}})",
    "forecast.source": "Источник {{source}}",
    "forecast.lowCoverage": "Низкое покрытие",
    "forecast.disclaimerTitle": "Академическое предупреждение",
    "forecast.disclaimerText": "Прогнозы строятся по историческим индикаторам (Gini, GDP, inflation, employment) и отражают предположения модели. Платформа не несёт ответственность за решения, принятые на основе прогнозных значений.",
    "forecast.model": "Модель: {{value}}",
    "forecast.assumptions": "Предпосылки: {{value}}",
    "forecast.metrics": "Метрики: {{value}}",
    "forecast.baseline": "База",
    "forecast.lastHistorical": "Последнее историческое значение",
    "forecast.change": "Изменение",
    "forecast.avgAnnual": "Среднегодовое: {{value}}",
    "forecast.percent": "Процент",
    "forecast.horizonShift": "Сдвиг за горизонт",
  },
  kz: {
    "language.ru": "RU",
    "language.kz": "KZ",
    "language.en": "EN",
    "navbar.kicker": "Теңсіздік және макроэкономикалық аналитика",
    "navbar.title": "Economic Signals Studio",
    "navbar.worldBank": "World Bank",
    "navbar.labNotes": "Lab Notes",
    "navbar.signIn": "Кіру",
    "navbar.account": "Аккаунт",
    "navbar.openSignIn": "Кіру терезесін ашу",
    "navbar.openAccount": "Аккаунт терезесін ашу",
    "navbar.themeLight": "Жарық",
    "navbar.themeDark": "Қараңғы",
    "navbar.switchTo": "{{mode}} режиміне ауыстыру",
    "navbar.lightMode": "жарық",
    "navbar.darkMode": "қараңғы",
    "layout.navigation": "Навигация",
    "layout.dashboard": "Дашборд",
    "layout.inequality": "Теңсіздік",
    "layout.forecast": "Болжам",
    "layout.saved": "Сақталған",
    "common.na": "жоқ",
    "common.close": "Жабу",
    "footer.referencesTitle": "Референстер",
    "footer.referencesSubtitle": "Дереккөздер мен жоба сілтемелері футерге орналастырылды.",
    "home.heroKicker": "Дашборд",
    "home.heroTitle": "Теңсіздік пен макроэкономикалық факторларды салыстыру.",
    "home.heroSubtitle": "Елдер бойынша индикаторларды нормалаңыз, уақыт қатарларын сәйкестендіріңіз және теңсіздік, өсім, инфляция, жұмыссыздық арасындағы байланыстарды зерттеңіз.",
    "home.dataAssurance": "Дерек сапасы",
    "home.dataSourceItem": "Дереккөз: World Bank каталогы + IMF/OECD ingestion жоспары.",
    "home.dataHistoryItem": "Тарихи, туынды және болжам мәндері бөлек көрсетіледі.",
    "home.dataMissingItem": "Жетіспейтін деректер ашық көрсетіледі.",
    "home.controlsTitle": "Салыстыру баптаулары",
    "home.chartType": "График түрі",
    "home.chartLine": "Сызық",
    "home.chartBar": "Баған",
    "home.chartScatter": "Нүкте",
    "home.startYear": "Бастапқы жыл",
    "home.endYear": "Соңғы жыл",
    "home.runComparison": "Салыстыруды іске қосу",
    "home.loading": "Жүктелуде...",
    "home.countSummary": "{{countries}} ел · {{indicators}} индикатор",
    "home.availableYearRange": "Қолжетімді жыл аралығы: {{min}}-{{max}}",
    "home.errorSelectMin": "Кемінде бір ел және бір индикатор таңдаңыз.",
    "home.errorTooManySelection": "Бір сұраныс үшін таңдау тым көп. Ең көбі {{countries}} ел және {{indicators}} индикатор.",
    "home.errorStartEnd": "Бастапқы жыл соңғы жылдан үлкен болмауы керек.",
    "home.errorYearRange": "Жыл аралығы {{min}} мен {{max}} арасында болуы керек.",
    "home.errorLoad": "Аналитиканы жүктеу сәтсіз. FastAPI іске қосылғанын тексеріңіз.",
    "selector.countries": "Елдер",
    "selector.searchCountry": "Елді іздеу...",
    "selector.noCountries": "Елдер табылмады.",
    "selector.countriesSelected": "{{selected}}/{{max}} таңдалды. Елдерді салыстыру үшін чекбоксты қолданыңыз.",
    "selector.tooManyCountries": "Ел саны тым көп. Максимум: {{max}}.",
    "selector.indicators": "Индикаторлар",
    "selector.searchIndicator": "Индикаторды іздеу...",
    "selector.noIndicators": "Индикатор табылмады.",
    "selector.indicatorsSelected": "{{selected}}/{{max}} таңдалды. Индикаторларды салыстыру үшін чекбоксты қолданыңыз.",
    "selector.tooManyIndicators": "Индикатор тым көп. Максимум: {{max}}.",
    "comparison.empty": "Елдер мен индикаторларды таңдаңыз, содан кейін график құру үшін салыстыруды іске қосыңыз.",
    "comparison.historicalByCountry": "Елдер бойынша тарихи қатарлар. Бос мәндер дерек тұтастығын сақтау үшін өзгертілмейді.",
    "comparison.exportCsv": "CSV жүктеу",
    "comparison.correlationSnapshot": "Корреляция көрінісі",
    "comparison.correlationSubtitle": "{{indicatorA}} және {{indicatorB}} индикаторларының қиылысатын жылдардағы Пирсон корреляциясы.",
    "chart.selectFilters": "Фильтрлерді таңдап, деректі жүктеңіз.",
    "chart.lineOfEquality": "Теңдік сызығы",
    "chart.populationShare": "Халықтың жинақталған үлесі",
    "chart.incomeShare": "Табыстың жинақталған үлесі",
    "chart.tooltipLorenz": "{{label}}: халық {{population}}, табыс {{income}}",
    "chart.year": "Жыл",
    "chart.value": "Мән",
    "chart.downloadPng": "PNG жүктеу",
    "ai.defaultPrompt": "График не көрсететінін және қандай трендтер маңызды екенін түсіндір.",
    "ai.title": "AI график агенті",
    "ai.subtitle": "Ағымдағы график туралы сұрақ қойып, қысқа аналитикалық түсіндірме алыңыз.",
    "ai.questionLabel": "Сұрағыңыз",
    "ai.placeholder": "Мысалы: қай ел жылдам өсуде және негізгі тәуекелдер қандай?",
    "ai.analyzing": "Талдау...",
    "ai.explain": "Графикті түсіндіру",
    "ai.rangeIndicators": "Аралығы: {{start}}-{{end}} · Индикатор: {{count}}",
    "ai.errorNoData": "Алдымен салыстыруды іске қосып, AI агентке сұрақ енгізіңіз.",
    "ai.errorFailed": "AI түсіндірмесін алу сәтсіз. FastAPI провайдері баптауын тексеріңіз.",
    "ai.explanationTitle": "AI түсіндірме",
    "ai.provider": "Провайдер",
    "ai.model": "Модель",
    "ai.providerNa": "жоқ",
    "forecastPage.heroKicker": "Болжам",
    "forecastPage.heroTitle": "Айқын базалық болжамдар жасаңыз.",
    "forecastPage.heroSubtitle": "Болжамда сенім интервалдары және backtesting метрикалары (MAE/RMSE) бар.",
    "forecastPage.accessTitle": "Қолжетімділік",
    "forecastPage.accessSubtitle": "Болжам endpoint-теріне кіру үшін келісімді қабылдау қажет.",
    "inequalityPage.heroKicker": "Теңсіздік аналитикасы",
    "inequalityPage.heroTitle": "Теңсіздік динамикасын уақыт бойынша бақылаңыз.",
    "inequalityPage.heroSubtitle": "Gini трендтерін, жылдық өзгерістерді және елдер арасындағы траекторияларды салыстырыңыз.",
    "inequalityPage.notesTitle": "Ескертпелер",
    "inequalityPage.note1": "Серверлік талап: келісімді қабылдау қажет.",
    "inequalityPage.note2": "Ашықтық үшін дереккөздер көрсетіледі.",
    "savedPage.title": "Сақталған талдау пресеттері",
    "savedPage.subtitle": "Пресеттер елдер, индикаторлар, график түрі және жыл аралығын сақтауға көмектеседі. Басқару беттің төменгі жағындағы Saved presets блогында қолжетімді.",
    "auth.session": "Сессия",
    "auth.signedInAs": "{{username}} ретінде кірдіңіз",
    "auth.signOut": "Шығу",
    "auth.access": "Қолжетімділік",
    "auth.login": "Кіру",
    "auth.register": "Тіркелу",
    "auth.username": "Пайдаланушы аты",
    "auth.email": "Email",
    "auth.password": "Құпиясөз",
    "auth.agreeTo": "{{title}} келісемін",
    "auth.processing": "Өңделуде...",
    "auth.signIn": "Кіру",
    "auth.createAccount": "Аккаунт ашу",
    "auth.loginFailed": "Кіру сәтсіз. Деректерді тексеріңіз.",
    "auth.registrationFailed": "Тіркелу сәтсіз. Форманы тексеріп, қайта көріңіз.",
    "auth.registrationSuccess": "Тіркелу сәтті. Енді кіре аласыз.",
    "auth.agreementUnavailable": "Келісім қолжетімсіз.",
    "auth.invalidCredentials": "Қате логин немесе құпиясөз.",
    "auth.sessionExpired": "Сессия уақыты аяқталды.",
    "agreement.title": "Пайдаланушы келісімі",
    "agreement.loading": "Келісім жүктелуде...",
    "agreement.none": "Белсенді келісім жарияланбаған.",
    "agreement.version": "{{version}} нұсқа",
    "agreement.required": "Болжам және кеңейтілген аналитика үшін келісім қажет.",
    "agreement.accepted": "Қабылданды",
    "agreement.accept": "Қабылдау",
    "preset.title": "Сақталған пресеттер",
    "preset.signInHint": "Талдау баптауларын сақтау және қалпына келтіру үшін кіріңіз.",
    "preset.name": "Пресет атауы",
    "preset.placeholder": "мысалы: KZ vs RU · Gini + inflation",
    "preset.overwrite": "Егер атау бар болса, үстінен жазу",
    "preset.saving": "Сақталуда...",
    "preset.saveCurrent": "Ағымдағы таңдауды сақтау",
    "preset.errorLoad": "Сақталған пресеттерді жүктеу мүмкін болмады.",
    "preset.errorName": "Пресет атауын енгізіңіз.",
    "preset.errorSignIn": "Пресет сақтау үшін жүйеге кіріңіз.",
    "preset.saved": "Пресет сақталды.",
    "preset.errorExists": "Бұл атау бар. Ауыстырып жазуды қосыңыз.",
    "preset.errorSave": "Пресетті сақтау сәтсіз.",
    "preset.loaded": "Жүктелді: {{name}}",
    "preset.deleted": "Пресет өшірілді.",
    "preset.errorDelete": "Пресетті өшіру сәтсіз.",
    "preset.none": "Әзірге сақталған пресеттер жоқ.",
    "preset.updated": "Жаңартылды {{date}}",
    "preset.load": "Жүктеу",
    "preset.delete": "Өшіру",
    "gini.errorSelectCountry": "Gini трендін жүктеу үшін кемінде бір ел таңдаңыз.",
    "gini.errorNeedAgreement": "Теңсіздік аналитикасын ашу үшін келісімді қабылдаңыз.",
    "gini.errorFailed": "Gini трендін жүктеу сәтсіз. FastAPI іске қосылғанын және келісім қабылданғанын тексеріңіз.",
    "gini.title": "Теңсіздік тренді (Gini)",
    "gini.subtitle": "World Bank Gini индикаторы (SI.POV.GINI) негізіндегі тренд сызығы.",
    "gini.loading": "Жүктелуде...",
    "gini.load": "Gini трендін жүктеу",
    "gini.lastYear": "Соңғы жыл: {{year}}",
    "gini.noData": "Дерек жоқ",
    "gini.source": "Дереккөз {{source}}",
    "forecast.title": "Болжам студиясы",
    "forecast.subtitle": "Болжамдар ықтималдыққа негізделген және кепілдік емес. Оларды академиялық талдау үшін пайдаланыңыз.",
    "forecast.predictionsOnly": "Тек болжам",
    "forecast.country": "Ел",
    "forecast.selectCountry": "Елді таңдаңыз",
    "forecast.indicator": "Индикатор",
    "forecast.selectIndicator": "Индикаторды таңдаңыз",
    "forecast.horizon": "Горизонт (жыл)",
    "forecast.chartHistorical": "Тарихи",
    "forecast.chartForecast": "Болжам",
    "forecast.chartLower": "Төменгі шек",
    "forecast.chartUpper": "Жоғарғы шек",
    "forecast.running": "Орындалуда...",
    "forecast.generate": "Жасау",
    "forecast.latestRun": "Соңғы іске қосу",
    "forecast.errorSelect": "Ел мен индикаторды таңдаңыз.",
    "forecast.errorGenerate": "Болжам жасау сәтсіз. Деректер жүктелгенін және келісім қабылданғанын тексеріңіз.",
    "forecast.errorLatest": "Бұл таңдау үшін сақталған болжам табылмады.",
    "forecast.needAgreement": "Болжам endpoint-терін ашу үшін белсенді келісімді қабылдаңыз.",
    "forecast.dataQuality": "Дерек сапасы",
    "forecast.coverage": "Қамту {{percent}}% ({{actual}}/{{expected}})",
    "forecast.source": "Дереккөз {{source}}",
    "forecast.lowCoverage": "Қамту төмен",
    "forecast.disclaimerTitle": "Академиялық ескерту",
    "forecast.disclaimerText": "Болжамдар тарихи индикаторлар (Gini, GDP, inflation, employment) бойынша жасалады және модель болжамдарын көрсетеді.",
    "forecast.model": "Модель: {{value}}",
    "forecast.assumptions": "Алғышарттар: {{value}}",
    "forecast.metrics": "Метрикалар: {{value}}",
    "forecast.baseline": "База",
    "forecast.lastHistorical": "Соңғы тарихи мән",
    "forecast.change": "Өзгеріс",
    "forecast.avgAnnual": "Орташа жылдық: {{value}}",
    "forecast.percent": "Пайыз",
    "forecast.horizonShift": "Горизонт бойынша өзгеріс",
  },
};

function getInitialLanguage() {
  if (typeof window === "undefined") return "ru";
  const saved = window.localStorage.getItem(LANGUAGE_KEY);
  if (SUPPORTED_LANGUAGES.includes(saved)) return saved;
  return "ru";
}

function interpolate(template, variables = {}) {
  return String(template).replace(/\{\{(\w+)\}\}/g, (_, key) => {
    return variables[key] == null ? "" : String(variables[key]);
  });
}

export function I18nProvider({ children }) {
  const [language, setLanguage] = useState(getInitialLanguage);

  useEffect(() => {
    window.localStorage.setItem(LANGUAGE_KEY, language);
    document.documentElement.lang = language;
  }, [language]);

  const t = useCallback((key, variables) => {
    const current = DICTIONARY[language] || {};
    const fallback = DICTIONARY.en || {};
    const template = current[key] ?? fallback[key] ?? key;
    return interpolate(template, variables);
  }, [language]);

  const value = useMemo(
    () => ({
      language,
      setLanguage: (nextLanguage) => {
        if (SUPPORTED_LANGUAGES.includes(nextLanguage)) {
          setLanguage(nextLanguage);
        }
      },
      supportedLanguages: SUPPORTED_LANGUAGES,
      t,
    }),
    [language, t]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
}

export default I18nContext;
